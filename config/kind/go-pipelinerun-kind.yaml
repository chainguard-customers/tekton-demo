apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: go-shared-task-storage
spec:
  resources:
    requests:
      storage: 2Gi
  volumeMode: Filesystem
  accessModes:
    - ReadWriteOnce
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: go-dependencies-storage
spec:
  resources:
    requests:
      storage: 2Gi
  volumeMode: Filesystem
  accessModes:
    - ReadWriteOnce

---
apiVersion: tekton.dev/v1beta1
kind: PipelineRun
metadata:
  name: go-build-pipeline-run
spec:
  serviceAccountName: default
  taskRunSpecs:
    - pipelineTaskName: sign-image
      taskServiceAccountName: build-bot
    - pipelineTaskName: trivy-scan
      taskServiceAccountName: build-bot
  params:
    - name: git-url
      value: "https://github.com/chainguard-customers/tekton-demo"
    - name: git-revision
      value: "main"
    - name: MAIN_DIR
      value: "."
    - name: KO_DOCKER_REPO
      value: "ghcr.io/chainguard-customers"
    - name: COSIGN_REPOSITORY
      value: "ghcr.io/chainguard-customers"
    - name: FULCIO_ENDPOINT
      value: "https://fulcio.sigstore.dev"
    - name: REKOR_ENDPOINT
      value: "https://rekor.sigstore.dev"
  pipelineRef:
    name: go-build-pipeline
  workspaces:
  - name: git-source # must match workspace name in Pipeline
    persistentVolumeClaim:
      claimName: go-shared-task-storage # this PVC must already exist
  - name: dependencies # must match workspace name in Pipeline
    persistentVolumeClaim:
      claimName: go-dependencies-storage # this PVC must already exist
